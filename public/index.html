const dns = require('dns/promises');

const MX_LOGIN_PROVIDERS = {
  'secureserver.net': 'https://sso.godaddy.com/?realm=pass&app=ox',
  'outlook.com': 'https://outlook.office365.com',
  'protection.outlook.com': 'https://outlook.office365.com',
  'zoho.com': 'https://mail.zoho.com',
  'google.com': 'https://mail.google.com',
  // Add more here as needed
};

async function detectLoginURL(domain) {
  try {
    const mxRecords = await dns.resolveMx(domain);
    const mxHostnames = mxRecords.map(mx => mx.exchange.toLowerCase());

    for (const host of mxHostnames) {
      for (const key in MX_LOGIN_PROVIDERS) {
        if (host.includes(key)) {
          return {
            domain,
            provider: key,
            loginURL: MX_LOGIN_PROVIDERS[key]
          };
        }
      }
    }

    return {
      domain,
      provider: 'unknown',
      loginURL: null,
      note: 'No known provider match in MX records.'
    };
  } catch (err) {
    return {
      error: `Failed to resolve MX for ${domain}: ${err.message}`
    };
  }
}

// Example usage
detectLoginURL('earthbluerelocation.com').then(console.log);
